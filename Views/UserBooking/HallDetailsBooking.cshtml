@{
    ViewData["Title"] = "Hall Booking";
}

@model HallBookingBhatPara.Domain.DTO.MultipleModel

@{
    var allowedDates = Model.hallBookingDTO.hallAvailableDateDTOs
        ?.Where(d => !string.IsNullOrEmpty(d.available_date))
        .Select(d => DateTime.Parse(d.available_date).ToString("yyyy-MM-dd"))
        .ToList() ?? new List<string>();

    var allowedDatesJson = System.Text.Json.JsonSerializer.Serialize(allowedDates);

    var rate = Model.hallBookingDTO.rate;

    var securityMoney = Model.hallBookingDTO.security_money;

    var InitialPayableRate = Model.hallBookingDTO.payable_rate + Model.hallBookingDTO.security_money;
}

<!-- Header Section -->
<section class="booking-header">
    <div class="container">
        <div class="row justify-content-center text-center">
            <div class="col-lg-8">
                <h1 class="booking-title">
                    <i class="fas fa-calendar-plus"></i> Book Your Hall
                </h1>
                <p class="booking-subtitle">Complete your booking for the perfect venue</p>

                @* <nav class="breadcrumb-nav">
                    <ol class="breadcrumb justify-content-center">
                        <li class="breadcrumb-item">
                            <a href="#"><i class="fas fa-home"></i> Home</a>
                        </li>
                        <li class="breadcrumb-item">
                            <a href="#"><i class="fas fa-search"></i> Search Halls</a>
                        </li>
                        <li class="breadcrumb-item active">
                            <i class="fas fa-calendar-plus"></i> Book Hall
                        </li>
                    </ol>
                </nav> *@
            </div>
        </div>
    </div>
</section>


<!-- Main Content -->
<div class="container">
    <!-- Hall Information Card -->
    <div class="hall-info-card">
        <div class="hall-summary">
            <div class="hall-icon">
                <i class="fas fa-building"></i>
            </div>
            <div class="hall-details">
                <h3>@Model.hallBookingDTO.category_name</h3>
                <div class="hall-meta">
                    <div class="meta-item">
                        <i class="fas fa-map-marker-alt text-danger"></i>
                        <span>Bhatpara</span>
                    </div>
                    @* <div class="meta-item">
                        <i class="fas fa-users text-primary"></i>
                        <span>500 Guests</span>
                    </div> *@
                    <div class="meta-item">
                        <i class="fas fa-tag text-success"></i>
                        <span>@Model.hallBookingDTO.hall_name</span>
                    </div>
                    <div class="meta-item">
                        <i class="fas fa-rupee-sign text-warning"></i>
                        <span>₹@Model.hallBookingDTO.rate/day</span>
                    </div>
                    @if (!string.IsNullOrEmpty(Model.hallBookingDTO.floor_name))
                    {
                        <div class="meta-item">
                            <span class="hall-floor">@Model.hallBookingDTO.floor_name</span>
                        </div>
                    }
                </div>
            </div>
        </div>
    </div>

    <!-- Booking Form -->
    <div class="booking-form-container">
        <form id="bookingForm">
            <!-- Personal Information -->
            <div class="form-section">
                @Html.AntiForgeryToken()
                <input type="hidden" id="allowedDatesHidden" value='@allowedDatesJson' />
                <input type="hidden" id="hiddenCatId" value='@Model.hallBookingDTO.category_id_pk' />
                <input type="hidden" id="hiddenHallId" value='@Model.hallBookingDTO.hall_id_pk' />
                <input type="hidden" id="HiddenHallAvailId" value='@Model.hallBookingDTO.hall_availability_id_pk' />
                <input type="hidden" id="hiddenRate" value='@rate' />
                <input type="hidden" id="hiddenSecurityMoney" value='@securityMoney' />
                <input type="hidden" id="hiddenInitialPayableRate" value='@InitialPayableRate' />

                <h4 class="section-title">
                    <i class="fas fa-user"></i> Personal Information
                </h4>
                <div class="row g-3">
                    <div class="col-md-6">
                        <label for="fullName" class="form-label">Full Name <span class="required">*</span></label>
                        <input type="text" class="form-control" id="fullName" value="@Model.public_User_Registration.user_name">
                        <div class="invalid-feedback">Please enter your full name.</div>
                    </div>
                    <div class="col-md-6">
                        <label for="email" class="form-label">Email Address <span class="required">*</span></label>
                        <input type="email" class="form-control" id="email" value="@Model.public_User_Registration.email">
                        <div class="invalid-feedback">Please enter a valid email address.</div>
                    </div>
                    <div class="col-md-6">
                        <label for="phone" class="form-label">Phone Number <span class="required">*</span></label>
                        <input type="tel" class="form-control" id="phone" value="@Model.public_User_Registration.mobile">
                        <div class="invalid-feedback">Please enter your phone number.</div>
                    </div>
                    <div class="col-md-6">
                        <label for="alternatePhone" class="form-label">Alternate Phone<span class="required">*</span></label>
                        <input type="tel" class="form-control" id="alternatePhone">
                        <div class="invalid-feedback">Please enter your alter phone number.</div>
                    </div>
                    <div class="col-12">
                        <label for="address" class="form-label">Full Address <span class="required">*</span></label>
                        <textarea class="form-control" id="address" rows="3"></textarea>
                        <div class="invalid-feedback">Please enter your full address.</div>
                    </div>
                </div>
            </div>

            <!-- Event Details -->
            <div class="form-section">
                <h4 class="section-title">
                    <i class="fas fa-calendar-alt"></i> Event Details (@Model.hallBookingDTO.category_name - @Model.hallBookingDTO.hall_name)
                    @if (!string.IsNullOrEmpty(Model.hallBookingDTO.floor_name))
                    {
                        <span class="hall-floor">@Model.hallBookingDTO.floor_name</span>
                    }                   
                </h4>
                <div class="row g-3">                    
                    <div class="col-md-6">
                        <label for="eventType" class="form-label">Event Type <span class="required">*</span></label>
                        <select class="form-select" id="eventType">
                            <!option value="0">--Select Event Type--</!option>
                            @foreach (var item in Model.dropDownListDTOs)
                            {
                                <!option value="@item.Id">@item.Name</!option>
                            }
                        </select>
                        <div class="invalid-feedback">Please select an event type.</div>
                    </div>
                   
                    @* <div class="col-md-4">
                        <label for="eventDate" class="form-label">Event Date <span class="required">*</span></label>
                        <input type="text" class="form-control" id="eventDate" placeholder="--Select Event Date--">
                        <div class="invalid-feedback">Please select event date.</div>
                    </div> *@
                    <!-- New Event Duration Type Field -->
                    <!-- New Event Duration Type Field -->
                    <!-- New Event Duration Type Field -->
                    <div class="col-md-6">
                        <label for="eventDurationType" class="form-label">Event Duration Type <span class="required">*</span></label>
                        <select class="form-select" id="eventDurationType">
                            <option value="">--Select Duration Type--</option>
                            <option value="single">Single Day Event</option>
                            <option value="multiple">Multiple Days Event</option>
                        </select>
                        <div class="invalid-feedback">Please select event duration type.</div>
                    </div>

                    <!-- Single Day Event Date -->
                    <div class="col-md-6" id="singleDateContainer" style="display: none;">
                        <label for="eventDate" class="form-label">Event Date <span class="required">*</span></label>
                        <input type="text" class="form-control" id="eventDate" placeholder="--Select Event Date--" readonly>
                        <div class="invalid-feedback">Please select event date.</div>
                    </div>

                    <!-- Multiple Days Event Dates -->
                    <div class="col-md-6" id="multipleDatesContainer" style="display: none;">
                        <label for="eventDatesRange" class="form-label">Event Dates Range <span class="required">*</span></label>
                        <input type="text" class="form-control" id="eventDatesRange" placeholder="--Select Date Range--" readonly>
                        <div class="invalid-feedback">Please select event dates range.</div>
                        <small class="text-muted">Select start and end dates for your event</small>
                    </div>

                    <!-- Selected Dates Display for Multiple Days -->
                    <div class="col-12" id="selectedDatesDisplay" style="display: none;">
                        <label class="form-label">Selected Event Dates:</label>
                        <div class="selected-dates-container">
                            <div id="selectedDatesList" class="d-flex flex-wrap gap-2">
                                <!-- Selected dates will be displayed here as badges -->
                            </div>
                            <small class="text-muted">Total selected days: <span id="totalSelectedDays">0</span></small>
                        </div>
                    </div>

                    @* <div class="col-md-6">
                        <label for="eventName" class="form-label">Event Name <span class="required">*</span></label>
                        <input type="text" class="form-control" id="eventName" placeholder="e.g., Wedding Reception">
                        <div class="invalid-feedback">Please enter the event name.</div>
                    </div> *@
                    @* @if (!string.IsNullOrEmpty(@Model.hallBookingDTO.floor_name))
                    {
                        <div class="col-md-4">
                            <label for="floorType" class="form-label">Floor Type <span class="required">*</span></label>
                            <select class="form-select" id="floorType">
                                <!option value="0">--Select Floor Type--</!option>
                                @foreach (var item in Model.FloorList)
                                {
                                    if (item.Id == @Model.hallBookingDTO.hall_floor_id_pk)
                                    {
                                        <!option value="@item.Id" selected>@item.Name</!option>
                                    }
                                    else
                                    {
                                        <!option value="@item.Id">@item.Name</!option>
                                    }

                                }
                            </select>
                            <div class="invalid-feedback">Please select floor type.</div>
                        </div>
                    } *@
                    @* <div class="col-md-4">
                        <label for="startTime" class="form-label">Start Time <span class="required">*</span></label>
                        <input type="time" class="form-control" id="startTime">
                        <div class="invalid-feedback">Please select start time.</div>
                    </div>
                    <div class="col-md-4">
                        <label for="endTime" class="form-label">End Time <span class="required">*</span></label>
                        <input type="time" class="form-control" id="endTime">
                        <div class="invalid-feedback">Please select end time.</div>
                    </div> *@
                    @* <div class="col-md-6">
                        <label for="guestCount" class="form-label">Expected Guests <span class="required">*</span></label>
                        <input type="number" class="form-control" id="guestCount" min="1" max="500" required>
                        <div class="invalid-feedback">Please enter expected number of guests (1-500).</div>
                    </div> *@
                    @* <div class="col-md-6">
                        <label for="duration" class="form-label">Duration (Hours)</label>
                        <input type="number" class="form-control" id="duration" min="1" value="8" readonly>
                    </div> *@
                    @* <div class="col-12">
                        <label for="eventDescription" class="form-label">Event Description</label>
                        <textarea class="form-control" id="eventDescription" rows="3" placeholder="Brief description of your event..."></textarea>
                    </div> *@
                </div>

                <!-- Event Timeline -->
                <div class="event-timeline">
                    <h6><i class="fas fa-clock"></i> Event Timeline</h6>
                    <div class="timeline-item">
                        <div class="timeline-icon">
                            <i class="fas fa-key"></i>
                        </div>
                        <div>
                            <strong>Hall Access:</strong> 2 hours before event start
                        </div>
                    </div>
                    <div class="timeline-item">
                        <div class="timeline-icon">
                            <i class="fas fa-play"></i>
                        </div>
                        <div>
                            <strong>Event Duration:</strong> As per selected time
                        </div>
                    </div>
                    <div class="timeline-item">
                        <div class="timeline-icon">
                            <i class="fas fa-broom"></i>
                        </div>
                        <div>
                            <strong>Cleanup Time:</strong> 1 hour after event end
                        </div>
                    </div>
                </div>
            </div>

            <!-- Additional Services -->
            @* <div class="form-section">
                <h4 class="section-title">
                    <i class="fas fa-plus-circle"></i> Additional Services
                </h4>
                <div class="row g-3">
                    <div class="col-md-6">
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="catering" value="5000">
                            <label class="form-check-label" for="catering">
                                <strong>Catering Service</strong> - ₹5,000
                            </label>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="decoration" value="3000">
                            <label class="form-check-label" for="decoration">
                                <strong>Event Decoration</strong> - ₹3,000
                            </label>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="security" value="2000">
                            <label class="form-check-label" for="security">
                                <strong>Security Service</strong> - ₹2,000
                            </label>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="photography" value="8000">
                            <label class="form-check-label" for="photography">
                                <strong>Photography Package</strong> - ₹8,000
                            </label>
                        </div>
                    </div>
                </div>
            </div> *@

            <!-- Price Summary -->
            <div class="form-section">
                <h4 class="section-title">
                    <i class="fas fa-calculator"></i> Price Summary
                </h4>
                <div class="price-summary">
                    <div class="price-item" style="background: chocolate;">
                        <span>Total Rent</span>
                        <span>₹@rate</span>
                    </div>
                    <div class="price-item">
                        <span>Initial Payable Amount(75%)</span>
                        <span>₹@Model.hallBookingDTO.payable_rate</span>
                    </div>
                    @* <div class="price-item" id="additionalServices" style="display: none;">
                        <span>Additional Services</span>
                        <span id="servicesTotal">₹0</span>
                    </div> *@
                    <div class="price-item">
                        <span>Security Deposit</span>
                        <span>₹@securityMoney</span>
                    </div>
                    <div class="total-price">
                        <span>Total Amount</span>
                        <span id="totalAmount">₹ @InitialPayableRate</span>
                    </div>
                </div>
            </div>

            <!-- Terms and Conditions -->
            <div class="terms-section">
                <h6><i class="fas fa-file-contract"></i> Terms & Conditions</h6>
                <ul class="terms-list">
                    <li>25% advance payment required to confirm booking</li>
                    <li>Remaining 75% amount to be paid wintin 1 month before event</li>
                    <li>Security deposit is refundable after event completion</li>
                    @* <li>Cancellation must be made 72 hours in advance</li> *@
                    <li>Any damage to property will be charged separately</li>
                    <li>Check in 8AM check out next day 7AM</li>
                </ul>
                <div class="form-check mt-3">
                    <input class="form-check-input" type="checkbox" id="agreeTerms">
                    <label class="form-check-label" for="agreeTerms">
                        I agree to all terms and conditions <span class="required">*</span>
                    </label>
                    <div class="invalid-feedback">You must agree to the terms and conditions.</div>
                </div>
            </div>

            <!-- Action Buttons -->
            <div class="action-buttons">
                <button type="button" class="btn-secondary-custom">
                    <i class="fas fa-arrow-left"></i> Back to Search
                </button>
                <button type="submit" class="btn-primary-custom">
                    <i class="fas fa-credit-card"></i> Proceed to Payment
                </button>
            </div>
        </form>
    </div>
</div>
